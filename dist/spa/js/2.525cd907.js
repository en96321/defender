(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"357a":function(e,t,n){"use strict";n("5f78")},"5f78":function(e,t,n){},"8b24":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{staticClass:"container"},[n("canvas",{ref:"game",staticClass:"game"})])},i=[],r=n("633b"),s={create:function(e){const t=new r["Engine"](e,!0);t.setHardwareScalingLevel(1/window.devicePixelRatio);const n=new r["Scene"](t);return e.setAttribute("oncontextmenu","return false"),window.addEventListener("resize",(()=>{t.resize()})),{scene:n,engine:t}}};let c=null,a=null;var l={load:function(e,t){r["SceneLoader"].Append("","./assets/maps/terrain.babylon",e,(()=>{e.executeWhenReady((()=>{const n=new r["DirectionalLight"]("dir01",new r["Vector3"](.2,-1,0),e);n.position=new r["Vector3"](0,20,0),a=new r["ArcRotateCamera"]("Camera",0,0,0,new r["Vector3"](0,20,10),e),e.activeCamera=a,e.collisionsEnabled=!0,c=new r["ShadowGenerator"](4096,n),e.meshes.forEach((e=>{e.receiveShadows=!0,"Plane"!==e.id&&(e.checkCollisions=!0,e.isPickable=!1),c.addShadowCaster(e)})),t(c,a,e.meshes)}))}))}};let m=!1;var u={registControl:function(e,t){e.onPointerUp=function(e,t){m=!1},e.onPointerDown=function(n,o){if(console.log(o.pickedPoint),3===n.which){const n=o.pickedPoint;n.y=0,t.moveToPoint(n);const i=d(e);i.emitter=new r["Vector3"](n.x,0,n.z),i.start(),m=!0}1===n.which&&t.emit(o)},e.onPointerMove=function(n,o){if(m){const n=e.pick(e.pointerX,e.pointerY).pickedPoint;n.y=0,t.moveToPoint(n)}}}};function d(e){const t=new r["ParticleSystem"]("clickParticles",50,e);return t.particleTexture=new r["Texture"]("./assets/textures/flare.png",e),t.layerMask=2,t.color1=new r["Color4"](.7,.8,1,1),t.color2=new r["Color4"](.2,.5,1,1),t.colorDead=new r["Color4"](0,0,.2,0),t.emitter=new r["Vector3"](0,2,0),t.minSize=.1,t.maxSize=.1,t.minLifeTime=.1,t.maxLifeTime=.3,t.emitRate=20,t.targetStopDuration=.3,t.createPointEmitter(new r["Vector3"](0,0,0),new r["Vector3"](0,1,0)),t.minEmitPower=1,t.maxEmitPower=3,t}let p=null,w=null,g=null;const h={q:{range:2,use:function(e,t){const n=new r["ParticleSystem"]("particles",3e3,e);n.particleTexture=new r["Texture"]("./assets/textures/flare.png",e);const o=e.pick(e.pointerX,e.pointerY).pickedPoint;o.y=0,t.lookAt(o),n.emitter=o,n.minEmitBox=new r["Vector3"](-1,0,-1),n.maxEmitBox=new r["Vector3"](1,5,1),n.color1=new r["Color4"](.7,0,.2,1),n.color2=new r["Color4"](.6,0,.1,1),n.colorDead=new r["Color4"](.1,0,0,0),n.minSize=.1,n.maxSize=.5,n.minLifeTime=.1,n.maxLifeTime=.5,n.emitRate=3e3,n.gravity=new r["Vector3"](0,-9.81,0),n.direction1=new r["Vector3"](-1,3,0),n.direction2=new r["Vector3"](1,3,0),n.minAngularSpeed=0,n.maxAngularSpeed=0,n.minEmitPower=1,n.maxEmitPower=5,n.updateSpeed=.01,n.start(),setTimeout((()=>{n.stop()}),300)}},w:{range:4,lifeTime:3e3,power:2e3,use:function(e,t){const n=new r["ParticleSystem"]("particles",6e3,e);n.particleTexture=new r["Texture"]("./assets/textures/flare.png",e);const o=e.pick(e.pointerX,e.pointerY).pickedPoint;o.y=0,t.lookAt(o),n.emitter=o,n.minEmitBox=new r["Vector3"](-2,0,-2),n.maxEmitBox=new r["Vector3"](2,5,2),n.color1=new r["Color4"](.7,.8,1,1),n.color2=new r["Color4"](.2,.5,1,1),n.colorDead=new r["Color4"](0,0,.2,0),n.minSize=.1,n.maxSize=.5,n.minLifeTime=.3,n.maxLifeTime=1.5,n.emitRate=6e3,n.gravity=new r["Vector3"](0,-9.81,0),n.direction1=new r["Vector3"](-7,8,3),n.direction2=new r["Vector3"](7,8,-3),n.minAngularSpeed=0,n.maxAngularSpeed=2*Math.PI,n.minEmitPower=1,n.maxEmitPower=5,n.updateSpeed=.005,n.start(),setTimeout((()=>{n.stop()}),3e3)}},e:{range:2,use:function(e,t){w=null,f.run.stop(),f.idle.start(!0,1,f.idle.from,f.idle.to,!1);const n=e.pick(e.pointerX,e.pointerY).pickedPoint;n.y=0,t.position=n}},r:{range:12,lifeTime:7e3,power:5e3,use:function(e,t){const n=new r["ParticleSystem"]("particles",7e3,e);n.particleTexture=new r["Texture"]("./assets/textures/flare.png",e);const o=e.pick(e.pointerX,e.pointerY).pickedPoint;o.y=0,t.lookAt(o),n.emitter=o,n.minEmitBox=new r["Vector3"](-6,0,-6),n.maxEmitBox=new r["Vector3"](6,5,6),n.color1=new r["Color4"](.2,0,.7,1),n.color2=new r["Color4"](.3,0,.6,1),n.colorDead=new r["Color4"](.1,0,.1,0),n.minSize=.3,n.maxSize=.6,n.minLifeTime=.3,n.maxLifeTime=1.5,n.emitRate=7e3,n.gravity=new r["Vector3"](0,-9.81,0),n.direction1=new r["Vector3"](-7,8,3),n.direction2=new r["Vector3"](7,8,-3),n.minAngularSpeed=0,n.maxAngularSpeed=2*Math.PI,n.minEmitPower=1,n.maxEmitPower=5,n.updateSpeed=.005,n.start(),setTimeout((()=>{n.stop()}),4e3)}}},f={run:null,idle:null};let k=null,x=!1,C=null;var P={create:function(e,t){g=e,r["SceneLoader"].ImportMesh("","","./assets/models/Soldier.glb",g,((n,o,i,s)=>{const c=new r["MeshBuilder"].CreateBox("box",{height:3,width:.9,depth:.9},g);c.position=new r["Vector3"](0,10,0),c.visibility=0,n[0].position=new r["Vector3"](0,-.2,0),n[0].rotation=new r["Vector3"](0,2*Math.PI,0),n[0].parent=c,c.checkCollisions=!0,p=c,c.actionManager=new r["ActionManager"](e),f.run=s[1],f.idle=s[0];const a=new r["StandardMaterial"]("magic",g),l=new r["Texture"]("./assets/textures/magic-circle.png",g);l.hasAlpha=!0,a.diffuseTexture=l,a.useAlphaFromDiffuseTexture=!0,k=r["MeshBuilder"].CreateCylinder("magic-circle",{height:.01,diameter:1},e,!0),k.material=a,k.visibility=0,g.actionManager=new r["ActionManager"](e),g.actionManager.registerAction(new r["ExecuteCodeAction"](r["ActionManager"].OnKeyDownTrigger,(e=>{switch(e.sourceEvent.key){case"q":C=h.q,k.scaling=new r["Vector3"](C.range,.01,C.range),x=!0;break;case"w":C=h.w,k.scaling=new r["Vector3"](C.range,.01,C.range),x=!0;break;case"e":C=h.e,k.scaling=new r["Vector3"](C.range,.01,C.range),x=!0;break;case"r":C=h.r,k.scaling=new r["Vector3"](C.range,.01,C.range),x=!0;break}}))),g.actionManager.registerAction(new r["ExecuteCodeAction"](r["ActionManager"].OnKeyUpTrigger,(t=>{x=!1,C.use(e,c)})));const m={model:c,animations:{run:s[1],idle:s[0]},emit:function(e){x=!1,console.log(C)},moveToPoint:function(e){p.lookAt(e),w=e},registCollision:function(e){c.actionManager.registerAction(new r["ExecuteCodeAction"]({trigger:r["ActionManager"].OnIntersectionEnterTrigger,parameter:e},(function(){"magic-circle"!==e.name&&(f.run.stop(),f.idle.start(!0,1,f.idle.from,f.idle.to,!1),w=null)})))},updatePosition:function(){k.visibility=x?1:0;const e=g.pick(g.pointerX,g.pointerY).pickedPoint;if(e.y=0,k.position=e,k.rotation.y+=.01,p.position.y-.3<0)p.position.y=0;else{const e=new r["Vector3"](0,-.3,0);p.moveWithCollisions(e)}if(null!==w){const e=new r["Vector3"](Math.sin(p.rotation.y)/8,0,Math.cos(p.rotation.y)/8);p.intersectsPoint(w)?(f.run.stop(),f.idle.start(!0,1,f.idle.from,f.idle.to,!1),w=null):(p.moveWithCollisions(e),f.idle.stop(),f.run.start(!0,1,f.run.from,f.run.to,!1))}}};t(m)}))}},v=(n("b234"),n("8e27")),S=n.n(v),T={name:"Main",data(){return{firstTime:!0,users:[],id:"",socket:null,game:{scene:null}}},methods:{init(){const e=s.create(this.$refs.game),{scene:t,engine:n}=e;l.load(t,((e,o,i)=>{P.create(t,(n=>{e.addShadowCaster(n.model),o.setTarget(n.model),u.registControl(t,n),t.registerBeforeRender((()=>{n.updatePosition()})),i.forEach((e=>{"Plane"!==e.name&&n.registCollision(e)}))})),n.runRenderLoop((()=>{t.render()}))}))},onKeyDown(e){switch(e.keyCode){case 38:case 87:this.controlUser.up=!0;break;case 40:case 83:this.controlUser.down=!0;break;case 37:case 65:this.controlUser.left=!0;break;case 39:case 68:this.controlUser.right=!0;break}},onKeyUp(e){switch(e.keyCode){case 38:case 87:this.stopMove(),this.controlUser.up=!1;break;case 40:case 83:this.stopMove(),this.controlUser.down=!1;break;case 37:case 65:this.stopMove(),this.controlUser.left=!1;break;case 39:case 68:this.stopMove(),this.controlUser.right=!1;break}},stopMove(){this.socket.emit("stopMove")},onConnect(){this.id=this.socket.id},onUserConnect(e){if(this.id!==e){const t={id:e,position:null};this.users.push(t)}},onUserDisconnect(e){},onUserStopMove(e){},onUserMove(e){},onLogin(e){this.firstTime&&(this.firstTime=!1)},connectServer(){this.socket=S()("http://120.110.7.112:3000"),this.socket.on("connect",this.onConnect),this.socket.on("userDisconnect",this.onUserDisconnect),this.socket.on("userConnect",this.onUserConnect),this.socket.on("usermove",this.onUserMove),this.socket.on("userStopMove",this.onUserStopMove),this.socket.on("locate",this.onLogin)}},mounted(){this.init()}},y=T,M=(n("357a"),n("2877")),V=n("9989"),b=n("eebe"),A=n.n(b),E=Object(M["a"])(y,o,i,!1,null,"2cfb8df1",null);t["default"]=E.exports;A()(E,"components",{QPage:V["a"]})}}]);